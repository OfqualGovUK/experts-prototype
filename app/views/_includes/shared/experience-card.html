{# Set a flag to test of the selected subject has been deleted, this comes fomr the hidden input on the delete screen #}
{% set deletedSubject = data.delete %}

{{ deletedSubject | log }}
{{ data.selectedSubject | log }}

{# If a subject has been selected #}
{% if data.selectedSubject  %}

  {% set qualificationHtml %}
    {# Build an list of the items selected #}
    <ul class="govuk-list">
      {% for qualification in data.selectedQualification %}
        <li>
          {{ qualification }}
        </li>
        {% if "Something that isn't listed" in data.selectedQualification %}
          <li>
            {{ data.selectedQualificationOther }}
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endset %} 

  {% set levelHtml %}
    {# Build an list of the items selected #}
    <ul class="govuk-list">
      {% for level in data.selectedLevel %}
        <li>
          {{ level }}
        </li>
        {% if "Something that isn't listed" in data.selectedLevel %}
          <li>
            {{ data.selectedLevelOther }}
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endset %}

  {% if deletedSubject != data.selectedSubject %}

    {{ xGovukSummaryCard({
      classes: "govuk-!-margin-bottom-9",
      titleText: data.job.roleName,
      actions: {
        items: [{
          text: "Delete choice",
          visuallyHiddenText: data.job.roleName,
          href: "./delete?delete=" + data.job.roleName
        }]
      },
      rows: [
        {
          key: {
            text: "Employer"
          },
          value: { 
            text: data.job.employerName or "Not provided"
          },
          actions: {
            items: [{
              text: "Change",
              visuallyHiddenText: "employer",
              href: "./job-details"
            }]
          }
        },
        {
          key: {
            text: "Role"
          },
          value: { 
            text: data.job.roleName or "Not provided"
          },
          actions: {
            items: [{
              text: "Change",
              visuallyHiddenText: "subject",
              href: "./select-subject"
            }]
          }
        },
        {
          key: {
            text: "Qualifications"
          },
          value: { 
            html: qualificationHtml
          },
          actions: {
            items: [{
              text: "Change",
              visuallyHiddenText: "Qualifications",
              href: "./select-qualification"
            }]
          }
        },
        {
          key: {
            text: "Qualification levels"
          },
          value: { 
            html: levelHtml
          },
          actions: {
            items: [{
              text: "Change",
              visuallyHiddenText: "Qualification levels",
              href: "./select-levels"
            }]
          }
        }
      ]
    }) }}

  {% endif %}

{% endif %}

{% if not data.job.roleName %}

  {{ appInsetText({
    sectionName: "Experience details",
    sectionHref: "./../experience",
    classes: "app-inset-text--error" if data.showErrors == "true"
  })}}

{% endif %}